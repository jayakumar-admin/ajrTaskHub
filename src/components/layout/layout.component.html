@if (isInitializing()) {
  <div class="fixed inset-0 flex items-center justify-center bg-gray-50 dark:bg-gray-900 z-[200]">
    <app-loading-spinner />
  </div>
} @else {
  <div class="bg-gray-50 dark:bg-gray-900 min-h-screen font-sans antialiased">
    <div class="relative min-h-screen md:flex">
      <!-- Sidebar for Desktop / Bottom Nav for Mobile -->
      <app-navbar></app-navbar>

      <!-- Main Content Area -->
      <div class="flex-1 flex flex-col md:ml-64">
        <app-header></app-header>
        <main class="flex-grow p-4 sm:p-6 pb-24 md:pb-6">
          <router-outlet></router-outlet>
        </main>
      </div>

      <!-- Global Chat Component -->
      @if(canUseChat()) {
        <app-chat [isOpen]="isChatOpen()" (closeChat)="closeChatPanel()"/>
      }

      <!-- Global Status Change Animation Overlay -->
      <app-status-change-overlay />
    </div>
  </div>
}
